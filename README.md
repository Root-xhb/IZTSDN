# IZTSDN
虚拟机操作注意事项：
1、初始化安装，需要更换源，拍初始快照

2、前期可以 su root切换到root账号
Sudo  passwd  root   可以更换新的密码

3、git的时候需要关闭全局代理
（1）取消代理
git config --global --unset http.proxy
git config --global --unset https.proxy    即可以直接拉取代码

4、Sudo 不能运行的时候，文件一般锁了，需要解锁
Sudo chmod -R 7777 文件名（最好在文件所在目录执行）

5、增加一个新用户
切换到 root
Useradd  -m 用户名
Passwd 用户名  设置新用户名的密码
删除一个用户
 Sudo userdel  -r 要删除的用户名
查看是否删除  ls -l . /home/
更改现有的用户名
登录界面直接可以点击修改
 
6、直接导出虚拟机 ovf 或者ova 都可以直接在其他虚拟机里面导入运行


进入mininet文件夹里面
 
继续进去example文件夹来启动mininet可视化界面 
 
进入界面以后可以点击图标来构建一个SDN仿真网络环境
 
从edit 选项栏中有勾选start CLI 选项来允许使用命令行
 
 
点击RUN开始运行网络环境
 
命令行开始运行，用 pingall 来测试整个网络通信状况，在以下这样的网络拓扑中，每个主机之间都是可以进行互相通信的
进/usr/local/lib/python2.7/dist-packages/mininet修改 cli.py
密钥 vyJbj2TmFLZvCBOBq07Uo1qgxMIDb4LvWyU7JhN4eJw=
 

现在需要进行初始化操作，初始化成功以后，意味着整个网络进入到初始化状态，互相之间无法通信
 


在初始化完成时，由于本项目基于零信任基础建立，所有主机之间是互相断开的状态，需要身份验证通过后方可建立连接。我们需要让他们建立连接
 
该valid命令接受三个必要参数： host1:此参数为需要建立的两台主机中的其中一台，为其名称，可通过miniedit界面查看主机名称，也可通过右键主机，选择Properties,修改Hostname修改该名称。 host2：此参数为需要建立的两台主机中的另一台，同上。 password：此参数为设置的秘钥，可通过项目目录下cli.py文件，找到SDPICSPwd参数，修改秘钥。


通过验证以后，设备之间可以进行正常的通信，通过测试发现只有验证通过的两个设备之间才能彼此通信
 

注：为确保成功运行环境，每次通信完以后需要清理流表，sudo  mn  -c 即可







以上已经完成了认证过程，接下来里需要我们通过RYU API 来实现ZTA的智能化，利用我们的已经训练好的模型来结合ZTA做一个用户行为的识别
首先来查看RYU虚拟机上面的ip
 
在mininet当中可以用命令行或者点击控制器来设置连接的ip地址，点击开始运行来实现流量的转发以及整个网络环境的正常运行
 
simple_switch_13.py模块是一个简单的交换机，是openflow1.3的交换机。后面的两个文件是为了进行restapi的调用加载的，方便直接用浏览器查看。
 
 
当我们在mininet这边网络环境进行操作的时候，流表通过RYU来控制转发，在浏览器中我们看到交换机状态信息
 
查看交换机当前的流表
 


得到端口的统计信息
 
得到端口配置信息
 

更换源（阿里或者清华，有时候安装需要指定适用豆瓣的源）以及每次完成一项重要实验需要经常拍快照



实验具体步骤
一、	Introduction
软件定义的网络有各种协议和控制器，每种协议和控制器都设计为以某种方式执行，并在特定方面提供效率和灵活性。所提出的方法是使用最流行和最优秀的工具实现的，用于在软件定义的网络中检测和缓解用户发起的攻击。
Openflow协议是软件定义网络中最流行的标准协议，因此本项目使用openVswitch。由于所提出的方法是统计方法和机器学习方法的结合，因此逻辑和技术是使用python编程的。统计方法包括源IP速度、流速和流对入口比等参数，所有这些逻辑都在控制器中编程。
Ryu Controller是一个基于python的开源可编程控制器，用于定义方法中交换机要遵循的规则和逻辑。
Mininet是一个网络模拟器，它创建了一个带有控制器、交换机和主机的虚拟网络拓扑，在这项工作中，为多个测试创建了一个带有10个和25个主机的openVswitch。
Hping3是在网络中生成TCP/IP流量的数据包生成器，主要用于测试网络安全。编写正常和攻击流量脚本以使用此工具自动生成流量。
Iperf也是一个网络流量生成器和网络性能测试仪，在本工作中，它用于手动生成流量。
二、	仿真平台步骤
必须安装用于SDN或OpenVswitch的Openflow协议，因为它是软件定义的网络-交换机（2009）的标准协议。
1、打开终端并键入以下命令：ovs-vsctl --version
 




2、必须安装Ryu控制器，以查看检测和缓解阶段的过程。要安装ryu控制器，需要安装python的PIP3来安装python软件包，因为ryu是基于python的控制器，所以必须使用PI3P安装。要安装PIP和Ryu控制器，请在终端的这些命令中键入。
sudo  apt  install  python3-pip
 
pip3  --version
 
注：如果版本不是最新的，需要更新到最新的版本
		解决pip3更新一直停留在旧版本上面的安装问题
1：curl https://bootstrap.pypa.io/pip/3.5/get-pip.py -o get-pip.py（适用于3.5）
2：sudo  python3  get-pip.py  --force-reinstall
pip3更新到最新的版本，现在可以继续安装

sudo pip3 install ryu
耐心等待，正常安装是不会报错的
 
·	如果出现什么错误（无法导入什么模块，网上搜索发现需要安装eventlet指定版本），直接网上搜，寻找解决办法即可

ryu-manager –version  安装成功以后就可以查看ryu版本
 
说明RYU安装成功

可以通过sudo pip show ryu  寻找RYU安装位置 ，在该位置下去运行相应的命令 
 




Mininet是一个网络模拟器，为软件定义的网络创建虚拟网络拓扑
sudo apt-get install mininet
 
mn –version
 

Hping3是TCP/IP协议的网络数据包生成器和流量生成器，主要用于网络测试。

Iperf是网络流量性能工具，用于生成流量并对其进行监控
 
 




接下来需要安装一个用到的第三方库  ，使用（豆瓣源）比较稳定比较快
sudo pip3 install numpy  -i    https://pypi.douban.com/simple 
sudo pip3 install sklearn   -i   https://pypi.douban.com/simple
sudo pip3 install matplotlib -i   https://pypi.douban.com/simple 


三、	流量收集以及实验演示
流量的收集
流量数据必须收集并存储在文件中，以便支持向量机和决策树机器学习算法分析和预测攻击流量。

1.	正常流量的收集
	打开controller.py文件并更改APP TYPE=0和TEST TYPE=0，
	APP TYPE：这里0表示数据收集，1表示APP TYPE中的攻击检测，
	TEST TYPE：测试类型0表示正常流量数据收集，1表示4次攻击流量数据收集。
	Interval是以秒为单位的数据收集间隔，设置为3秒。
 
打开topo.py文件，并更改测试类型=正常，以在网络中生成正常流量（测试类型“手动”是使用Iperf工具在mininet中手动生成流量），测试时间=600，以收集持续时间为600秒的数据，建议至少400秒以提高准确性。使用并运行文件topo25.py将有25台主机用于测试。
 
打开Terminal窗口，确保 位于project source codes文件夹中，然后启动ryu-manager进行流量收集。
 

打开另一个终端窗口，启动拓扑以正常生成流量
sudo python topo.py


下图显示了正在生成的正常流量，并将其存储在一个CSV文件中，其中包含流量计数和括号中的不同功能参数计数。
 




2.	攻击流量的收集
收集方式和正常流量收集方式相似
打开controller.py文件并更改APP TYPE=0和TEST TYPE=1（参见下图中的行号），其中0用于数据收集，1用于APP TYPE中的攻击检测，测试类型0用于正常流量数据收集，1用于攻击流量数据收集。Interval是以秒为单位的数据收集间隔，设置为3秒。

 

打开topo.py文件，并更改测试类型=攻击，以在网络中生成攻击流量，测试时间=600，以收集持续时间为600秒的数据。建议至少400秒以提高准确性。
 
打开Terminal窗口，确保 位于project source codes文件夹中，然后启动ryu-manager进行流量收集。
 


打开另一个终端窗口，清理mininet之前生成的流量历史记录。由于此流量与正常流量不同，每次更改流量生成器类型时，我们都需要清理mininet历史记录，然后启动拓扑以生成攻击流量。
 
然后再打开sudo python topo.py
 




攻击检测和缓解
模拟本节我们将了解模拟DDOS攻击所涉及的步骤，并了解控制器如何检测攻击流量并缓解攻击。

正常检测打开controller.py文件，只更改APP TYPE=1，用于攻击检测。
 
打开Topo.py文件和测试类型=正常，以生成正常流量并保持测试时间=300，至少3秒足以让控制器进行检测，因为间隔保持为3秒。
 
打开Terminal窗口，确保 位于project source codes文件夹中，然后启动ryu manager进行流量收集。从下图可以看出，控制器和支持向量机将其预测为正常流量。

 

运行controller.py的同时也打开另一个终端窗口，启动拓扑以生成正常流量。
 


攻击流量检测和缓解
控制器无变化。我们仍在检测攻击。
打开Topo.py 和测试类型=攻击，以生成攻击流量并保持测试时间=300，控制器至少3秒就足以检测到，因为间隔保持为3秒。
 

打开另一个终端窗口并启动拓扑以生成攻击流量。打开Terminal窗口，确保 位于project source codes文件夹中，然后启动ryu manager进行流量收集。从下图可以看出，控制器和支持向量机将其预测为攻击流量，并阻止攻击来自的端口。然后将剩余流量预测为正常流量。 

控制器编程为封锁端口120秒，然后再次解除封锁的端口。但如果攻击流量仍在进入，则会再次阻塞端口。如下图所示。

 
 

准确度和检出率计算

确保位于“分析”文件夹中，并且已复制了结果。从前面的步骤生成的CSV文件，并将其复制到此分析文件夹中。进行准确度评分。图中显示了该方法获得的精度。它还显示了交叉验证分数。
 






性能测试
模型检测准确率、吞吐量来表面IZTA-SDN框架的性能

Hping3是TCP/IP协议的网络数据包生成器和流量生成器，主要用于网络测试。Iperf是网络流量性能工具，用于生成流量并对其进行监控






